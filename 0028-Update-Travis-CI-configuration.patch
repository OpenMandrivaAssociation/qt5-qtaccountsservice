From 5b21c2b4200fec26f0f38e27ad1222a58f166ce8 Mon Sep 17 00:00:00 2001
From: Pier Luigi Fiorini <pierluigi.fiorini@gmail.com>
Date: Wed, 5 Aug 2015 10:49:32 +0200
Subject: [PATCH 28/46] Update Travis CI configuration

---
 .travis.yml | 57 ++++++++++++++++++++++++---------------------------------
 1 file changed, 24 insertions(+), 33 deletions(-)

diff --git a/.travis.yml b/.travis.yml
index 0ec0b02..aad623e 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,45 +1,36 @@
-language: cpp
-
-cache: ccache
-
-sudo: required
-
-compiler:
-  - gcc
-
-addons:
-  apt:
-    sources:
-    - ubuntu-toolchain-r-test
-    - ubuntu-sdk-team
-#    - llvm-toolchain-precise
-  apt:
-    packages:
-    - g++-4.8
-    - qtdeclarative5-dev
-    - qttools5-dev
-    - qttools5-dev-tools
+before_install:
+  - "export DISPLAY=:99.0"
+  - "sh -e /etc/init.d/xvfb start"
 
 install:
-  # compiler
-  - export CXX="g++-4.8"
-  # qt
-  - sudo apt-get install qtdeclarative5-dev qttools5-dev qttools5-dev-tools
+  - sudo add-apt-repository -y ppa:beineri/opt-qt541
+  - sudo apt-get update
+  - sudo apt-get -y install qt54declarative qt54tools
+
+before_script:
   # cmake
-  - wget http://www.cmake.org/files/v3.3/cmake-3.3.0-Linux-x86_64.tar.gz -O /tmp/cmake.tar.gz
-  - tar -xzf /tmp/cmake.tar.gz
-  - export PATH=$PWD/cmake-3.3.0-Linux-x86_64/bin:$PATH
+  - wget --no-check-certificate http://www.cmake.org/files/v3.3/cmake-3.3.0-Linux-x86_64.tar.gz -O cmake.tar.gz
+  - tar -xzf cmake.tar.gz -C $HOME
+  - export PATH=$HOME/cmake-3.3.0-Linux-x86_64/bin:$PATH
   - cmake --version
   # e-c-m
-  - wget http://download.kde.org/stable/frameworks/5.12/extra-cmake-modules-5.12.0.tar.xz
+  - wget --no-check-certificate http://download.kde.org/stable/frameworks/5.12/extra-cmake-modules-5.12.0.tar.xz
   - tar -xJf extra-cmake-modules-5.12.0.tar.xz
-  - cd extra-cmake-modules-5.12.0 && mkdir build && cd build && cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/ecm && make && make install
+  - pushd extra-cmake-modules-5.12.0
+  - rm -rf build
+  - mkdir build
+  - cd build
+  - cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/ecm
+  - make && make install
+  - popd
   - export PATH=$HOME/ecm/bin:$PATH
-
-before_script:
+  # prepare
+  - source /opt/qt54/bin/qt54-env.sh
   - echo $PATH
   - mkdir build
   - cd build
   - cmake ..
 
-script: make
+script:
+  - make
+  - make test
-- 
1.9.5

